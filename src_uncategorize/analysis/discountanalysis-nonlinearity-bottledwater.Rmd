---
title: "Discount Elasticity Analysis for Bottled Water"
author: "Tanetpong"
date: "23/11/2021"
output: pdf_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../../gen/analysis") })
---

```{r setup and require library, include=FALSE, WARNING = FALSE}
library(dplyr) #for mutate factor level of brand
library(plyr) #for revalue function for brand
library(data.table) #for set DT checking brand
library(car) #testing differences in coefficients using frequentist way
library(lmtest) #testing for relevance of the variable using likelihood ratio
```

# Data Management

```{r read data, echo=FALSE}
df_scanner <- read.csv("../../data/df_scanner_butikid.csv")
categorydf <- "Bottled water"
df <-subset(df_scanner,category == categorydf)
df <- df %>% mutate(brand=droplevels(brand)) #Because the subset function doesnt drop the factor per se
df <- df %>% mutate(vecka=droplevels(as.factor(vecka))) #In case some categories doesnt have full week like another
#for simplicity, we will drop online sales for now (due to small data)
df_online <- subset(df, saljkanal == 1)
message(paste("The total number of weekly online sold for this category:", dim(df_online)[1]))
df <- subset(df, saljkanal == 0)
remove(list=c("df_scanner", "df_online")) #remove unnecessary file to make environment clean
df_holiday <- read.csv("../../data/weeklyholiday.csv")
df_holiday$vecka <- as.factor(df_holiday$vecka)
storeformat <- c("hypermarket","convenience","supermarket")
distinctformat<-unique(as.factor(storeformat))

#table(df$sales_volume) check if there is any decimal 
```

```{r Rename the brand of cereal for consistency, be careful of non-roman character, include=FALSE}
knitr::kable(table(df$brand),col.names = c('Brand','Frequency'))
df$brand<- revalue(df$brand, c(
              "BONAQUA SILVER"="bonaqua silver"
              ))
knitr::kable(table(df$brand),col.names = c('Brand After Revalue','Frequency'))
```


```{r select the brand with every weekly sales in all formats regardless of sku, echo=FALSE}
#create a table of distinct week
distinctweek<-unique(df$vecka)
message(paste("The total number of week sold for this category:", length(distinctweek)))
#calculate the brand sales by week
distinctbrand<-unique(df$brand)
message(paste("The total number of brand for this category:", length(distinctbrand)))
brandsalecount<-setDT(df)[, .N, .(vecka,brand,format)]
brandweeksalestime<-setDT(brandsalecount)[, .N, .(brand,format)]#we count if the brand got shown in the scanner data each week in each format
#select the brand that have complete week
brandcompleteweek<-subset(brandweeksalestime, N >= length(distinctweek))
brandcompleteweekformat <- setDT(brandcompleteweek)[, .N, .(brand)]
brandcomplete <- subset(brandcompleteweekformat, N >= 3) #have 3 format; hypermarket, supermarket and convenience
brandcomplete <- brandcomplete %>% mutate(brand=droplevels(brand))
distinctbrandcomplete<-unique(brandcomplete$brand)
message(paste("The total number of brand that has complete observation for this category:", dim(brandcomplete)[1]))

df_complete <- df[df$brand %in% brandcomplete$brand, ]
df_complete <- df_complete %>% mutate(brand=droplevels(brand))
message(paste("The number of observation before dropping non-complete brand:", dim(df)[1]))
message(paste("The number of observation after dropping non-complete brand:", dim(df_complete)[1]))

#remove used data
remove(list=c("brandsalecount", "brandweeksalestime","brandcompleteweek","brandcompleteweekformat","brandcomplete","df")) 
```



We want to compare between the *change in final price* vis a vis the *change in discount* and interesting to see the price before (now we will compare three aspects). Hence, we will create an aggregate price-related variable and line-length (aka assortment).

```{r calculate the brand price related variables and linelength or our main IV, echo=FALSE}
#Number of unique SKUs sold by brand b in period t
#Price of brand b in period t, computed as a sales-weighted average across its SKUs sold in period t
df_complete$pricebeforeperunit <- df_complete$spendingbeforedisc/df_complete$sales_volume
df_complete$finalpriceperunit <- df_complete$finalspending/df_complete$sales_volume
df_complete$discountperunit <- df_complete$totaldiscount/df_complete$sales_volume
df_complete$nonpricecampaign <- ifelse(df_complete$totaldiscount == 0 & df_complete$week_campaign > 0, 1, 0)
#calculated weight
weeklysalesbybrand<-setDT(df_complete)[, .(totalsales=sum(sales_volume),LL=uniqueN(produkt_id),totalnonpricecampaign=sum(nonpricecampaign)), .(vecka,brand,format)] #this will return n brand x 3 formats x 153 weeks
df_weightcalc <- merge(df_complete,weeklysalesbybrand, by=c("vecka","brand","format"))
df_weightcalc$wp <- df_weightcalc$sales_volume/df_weightcalc$totalsales
    # check<-setDT(df_weightcalc)[, .(totalwp=sum(wp)), .(vecka,brand,format)] #check if weight sum to 1
df_weightcalc$avgpricebefore <- df_weightcalc$pricebeforeperunit*df_weightcalc$wp
df_weightcalc$avgfinalprice <- df_weightcalc$finalpriceperunit*df_weightcalc$wp
df_weightcalc$avgdiscount <- df_weightcalc$discountperunit*df_weightcalc$wp
df_bybrand <- setDT(df_weightcalc)[, .(totalvolume=sum(sales_volume),totalvalue=sum(finalspending),LL=mean(LL),avgpricebefore=sum(avgpricebefore),avgfinalprice=sum(avgfinalprice),avgdiscount=sum(avgdiscount),nonpricecampaign=sum(totalnonpricecampaign)), .(vecka,brand,format)]
df_bybrand$nonpricecampaign <- ifelse(df_bybrand$nonpricecampaign > 0, 1, 0)

#remove prior df
remove(list=c("weeklysalesbybrand", "df_weightcalc"))
```


```{r create depth variable for calculation in log-log model ,include = FALSE}
df_bybrand$depth <- df_bybrand$avgdiscount/df_bybrand$avgpricebefore
df_bybrand$nondepth <- (1-df_bybrand$depth)
```




```{r calculate the competitor price and lag variable, echo=FALSE}
nbrand<-length(distinctbrandcomplete)
nweek<-length(distinctweek)
nformat <- length(distinctformat)

lag_1 <- function(x, k = 1) head(c(rep(NA, k), x), length(x))

#We calculate competitors info for each brand and then replace in the df_rep (rbind each brand)
  #Calculate hypermarket
df_rep <- data.frame(matrix(NA, ncol = 16 , nrow = ((nbrand)*(nweek)))) #create an empty table for iteration information of each brand
for (i in 1:length(distinctbrandcomplete)){
df_competitor=df_bybrand[df_bybrand$brand != distinctbrandcomplete[i]& df_bybrand$format == "hypermarket",]
weeklysalesbycompetingbrand<-setDT(df_competitor)[, .(totalmarketvolume=sum(totalvolume)), .(vecka)]
df_competitorweightcalc <- merge(df_competitor,weeklysalesbycompetingbrand, by=c("vecka"))
df_competitorweightcalc$wp <- df_competitorweightcalc$totalvolume/df_competitorweightcalc$totalmarketvolume
  # check<-setDT(df_competitorweightcalc)[, .(totalwp=sum(wp)), .(vecka)] #check if weight sum to 1
df_competitorweightcalc$avgcompLL <- df_competitorweightcalc$LL*df_competitorweightcalc$wp
df_competitorweightcalc$avgcomppricebefore <- df_competitorweightcalc$avgpricebefore*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompfinalprice <- df_competitorweightcalc$avgfinalprice*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompdiscount <- df_competitorweightcalc$avgdiscount*df_competitorweightcalc$wp
df_competitorinfo <- setDT(df_competitorweightcalc)[, .(avgcompLL=sum(avgcompLL),avgcomppricebefore=sum(avgcomppricebefore), avgcompfinalprice=sum(avgcompfinalprice), avgcompdiscount=sum(avgcompdiscount)), .(vecka)]
df_own=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "hypermarket",]
df_own <- merge(df_own,df_competitorinfo, by=c("vecka"))
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),] = df_own
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),2] <- toString(distinctbrandcomplete[i])
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),3] <- "hypermarket"
}
colnames(df_rep) <- colnames(df_own) #replace empty table column name with the original column name
df_rep[,1] <- df_own[,1] #the vecka infor is not replaced so we have to replace from the original table
df_rep$brand<-as.factor(df_rep$brand)
df_hyper_bybrand <- df_rep
#We have to sort the data in the way that we have the same brand and ascending order row before implementing lag
df_hyper_bybrand<-df_hyper_bybrand [order(df_hyper_bybrand$brand,df_hyper_bybrand$vecka),]
df_hyper_bybrand$totalvolume1 <- ave(df_hyper_bybrand$totalvolume, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$totalvalue1 <- ave(df_hyper_bybrand$totalvalue, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$LL1 <- ave(df_hyper_bybrand$LL, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgfinalprice1 <- ave(df_hyper_bybrand$avgfinalprice, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgpricebefore1 <- ave(df_hyper_bybrand$avgpricebefore, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgdiscount1 <- ave(df_hyper_bybrand$avgdiscount, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$nondepth1 <- ave(df_hyper_bybrand$nondepth, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgcompLL1 <- ave(df_hyper_bybrand$avgcompLL, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgcompfinalprice1 <- ave(df_hyper_bybrand$avgfinalprice, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgcomppricebefore1 <- ave(df_hyper_bybrand$avgpricebefore, df_hyper_bybrand$brand, FUN= lag_1)
df_hyper_bybrand$avgcompdiscount1 <- ave(df_hyper_bybrand$avgdiscount, df_hyper_bybrand$brand, FUN= lag_1)

remove(list=c("df_competitor","weeklysalesbycompetingbrand", "df_competitorweightcalc","df_competitorinfo","df_own","df_rep"))

  #Calculate supermarket
df_rep <- data.frame(matrix(NA, ncol = 16 , nrow = ((nbrand)*(nweek)))) 
for (i in 1:length(distinctbrandcomplete)){
df_competitor=df_bybrand[df_bybrand$brand != distinctbrandcomplete[i]& df_bybrand$format == "supermarket",]
weeklysalesbycompetingbrand<-setDT(df_competitor)[, .(totalmarketvolume=sum(totalvolume)), .(vecka)]
df_competitorweightcalc <- merge(df_competitor,weeklysalesbycompetingbrand, by=c("vecka"))
df_competitorweightcalc$wp <- df_competitorweightcalc$totalvolume/df_competitorweightcalc$totalmarketvolume
df_competitorweightcalc$avgcompLL <- df_competitorweightcalc$LL*df_competitorweightcalc$wp
df_competitorweightcalc$avgcomppricebefore <- df_competitorweightcalc$avgpricebefore*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompfinalprice <- df_competitorweightcalc$avgfinalprice*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompdiscount <- df_competitorweightcalc$avgdiscount*df_competitorweightcalc$wp
df_competitorinfo <- setDT(df_competitorweightcalc)[, .(avgcompLL=sum(avgcompLL),avgcomppricebefore=sum(avgcomppricebefore), avgcompfinalprice=sum(avgcompfinalprice), avgcompdiscount=sum(avgcompdiscount)), .(vecka)]
df_own=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "supermarket",]
df_own <- merge(df_own,df_competitorinfo, by=c("vecka"))
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),] = df_own
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),2] <- toString(distinctbrandcomplete[i])
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),3] <- "supermarket"
}
colnames(df_rep) <- colnames(df_own) #replace empty table column name with the original column name
df_rep[,1] <- df_own[,1] #the vecka infor is not replaced so we have to replace from the original table
df_rep$brand<-as.factor(df_rep$brand)
df_super_bybrand <- df_rep
df_super_bybrand<-df_super_bybrand [order(df_super_bybrand$brand,df_super_bybrand$vecka),]
df_super_bybrand$totalvolume1 <- ave(df_super_bybrand$totalvolume, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$totalvalue1 <- ave(df_super_bybrand$totalvalue, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$LL1 <- ave(df_super_bybrand$LL, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgfinalprice1 <- ave(df_super_bybrand$avgfinalprice, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgpricebefore1 <- ave(df_super_bybrand$avgpricebefore, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgdiscount1 <- ave(df_super_bybrand$avgdiscount, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$nondepth1 <- ave(df_super_bybrand$nondepth, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgcompLL1 <- ave(df_super_bybrand$avgcompLL, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgcompfinalprice1 <- ave(df_super_bybrand$avgfinalprice, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgcomppricebefore1 <- ave(df_super_bybrand$avgpricebefore, df_super_bybrand$brand, FUN= lag_1)
df_super_bybrand$avgcompdiscount1 <- ave(df_super_bybrand$avgdiscount, df_super_bybrand$brand, FUN= lag_1)

remove(list=c("df_competitor","weeklysalesbycompetingbrand", "df_competitorweightcalc","df_competitorinfo","df_own","df_rep"))

  #Calculate convenient
df_rep <- data.frame(matrix(NA, ncol = 16 , nrow = ((nbrand)*(nweek)))) 
for (i in 1:length(distinctbrandcomplete)){
df_competitor=df_bybrand[df_bybrand$brand != distinctbrandcomplete[i]& df_bybrand$format == "convenience",]
weeklysalesbycompetingbrand<-setDT(df_competitor)[, .(totalmarketvolume=sum(totalvolume)), .(vecka)]
df_competitorweightcalc <- merge(df_competitor,weeklysalesbycompetingbrand, by=c("vecka"))
df_competitorweightcalc$wp <- df_competitorweightcalc$totalvolume/df_competitorweightcalc$totalmarketvolume
df_competitorweightcalc$avgcompLL <- df_competitorweightcalc$LL*df_competitorweightcalc$wp
df_competitorweightcalc$avgcomppricebefore <- df_competitorweightcalc$avgpricebefore*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompfinalprice <- df_competitorweightcalc$avgfinalprice*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompdiscount <- df_competitorweightcalc$avgdiscount*df_competitorweightcalc$wp
df_competitorinfo <- setDT(df_competitorweightcalc)[, .(avgcompLL=sum(avgcompLL),avgcomppricebefore=sum(avgcomppricebefore), avgcompfinalprice=sum(avgcompfinalprice), avgcompdiscount=sum(avgcompdiscount)), .(vecka)]
df_own=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "convenience",]
df_own <- merge(df_own,df_competitorinfo, by=c("vecka"))
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),] = df_own
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),2] <- toString(distinctbrandcomplete[i])
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),3] <- "convenience"
}
colnames(df_rep) <- colnames(df_own) #replace empty table column name with the original column name
df_rep[,1] <- df_own[,1] #the vecka infor is not replaced so we have to replace from the original table
df_rep$brand<-as.factor(df_rep$brand)
df_convenience_bybrand <- df_rep
df_convenience_bybrand<-df_convenience_bybrand [order(df_convenience_bybrand$brand,df_convenience_bybrand$vecka),]
df_convenience_bybrand$totalvolume1 <- ave(df_convenience_bybrand$totalvolume, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$totalvalue1 <- ave(df_convenience_bybrand$totalvalue, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$LL1 <- ave(df_convenience_bybrand$LL, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgfinalprice1 <- ave(df_convenience_bybrand$avgfinalprice, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgpricebefore1 <- ave(df_convenience_bybrand$avgpricebefore, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgdiscount1 <- ave(df_convenience_bybrand$avgdiscount, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$nondepth1 <- ave(df_convenience_bybrand$nondepth, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgcompLL1 <- ave(df_convenience_bybrand$avgcompLL, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgcompfinalprice1 <- ave(df_convenience_bybrand$avgfinalprice, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgcomppricebefore1 <- ave(df_convenience_bybrand$avgpricebefore, df_convenience_bybrand$brand, FUN= lag_1)
df_convenience_bybrand$avgcompdiscount1 <- ave(df_convenience_bybrand$avgdiscount, df_convenience_bybrand$brand, FUN= lag_1)


remove(list=c("df_competitor","weeklysalesbycompetingbrand", "df_competitorweightcalc","df_competitorinfo","df_own","df_rep"))

#merge all format together
df_bybrand <- rbind(df_hyper_bybrand,df_super_bybrand,df_convenience_bybrand)
```

Next, we want to see the difference term between time. Hence, we need to create lagged variable (by brand)

```{r create the first difference of log variables, include=FALSE}
#We drop week 0
df_bybrand <- na.omit(df_bybrand)
df_bybrand$dlogtotalvolume <- log(df_bybrand$totalvolume)-log(df_bybrand$totalvolume1)
df_bybrand$dlogavgfinalprice <- log(df_bybrand$avgfinalprice)-log(df_bybrand$avgfinalprice1)
df_bybrand$dlogavgpricebefore <- log(df_bybrand$avgpricebefore)-log(df_bybrand$avgpricebefore1)
df_bybrand$dlognondepth <- df_bybrand$nondepth-df_bybrand$nondepth1
df_bybrand$dlogLL = log(df_bybrand$LL) - log(df_bybrand$LL1)
df_bybrand$dlogavgcompLL = log(df_bybrand$avgcompLL) - log(df_bybrand$avgcompLL1)
df_bybrand$dlogavgcompfinalprice = log(df_bybrand$avgcompfinalprice) - log(df_bybrand$avgcompfinalprice1)
```



```{r merge holiday info, echo=FALSE}
df_bybrand <- merge(df_bybrand,df_holiday[,2:3], by=c("vecka"))
```

```{r contral for seasonality}
#Do we have to control for seasonality of brand over time
```




* We report $\hat{\beta_{2'i}}$ as short term discount effect and $\hat{\beta_{6'i}}$ as long term discount effect and their standard errors.

```{r Estimate full linear model with table, echo=FALSE}
df_bybrand$nonpricecampaign <- as.factor(df_bybrand$nonpricecampaign)

df_linear_withdiscount_hyper <- data.frame(matrix(NA, ncol = 9 , nrow = (nbrand))) 
df_linear_withdiscount_super <- data.frame(matrix(NA, ncol = 9 , nrow = (nbrand))) 
df_linear_withdiscount_convenience <- data.frame(matrix(NA, ncol = 9 , nrow = (nbrand))) 

#Calculate lm for (before-discount)
  for (i in 1:length(distinctbrandcomplete)){
#lm for before&discount

lm_1_hyper <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + dlogavgcompLL + dlogavgcompfinalprice  + log(totalvolume1) + log(LL1) +log(avgfinalprice1) + holiday ,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "hypermarket",])
lm_1_super <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + dlogavgcompLL + dlogavgcompfinalprice + log(totalvolume1) + log(LL1) +log(avgfinalprice1) + holiday ,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "supermarket",])
lm_1_convenience <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + dlogavgcompLL + dlogavgcompfinalprice + log(totalvolume1) + log(LL1) +log(avgfinalprice1) + holiday,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "convenience",])

lm_1_hyper_withdiscount <- lm(dlogtotalvolume ~ dlogLL + dlogavgpricebefore + dlognondepth + dlogavgcompLL + dlogavgcompfinalprice  + log(totalvolume1) + log(LL1) +log(avgpricebefore1) + log(nondepth1) + holiday ,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "hypermarket",])
lm_1_super_withdiscount <- lm(dlogtotalvolume ~ dlogLL + dlogavgpricebefore + dlognondepth + dlogavgcompLL + dlogavgcompfinalprice  + log(totalvolume1) + log(LL1) +log(avgpricebefore1) + log(nondepth1) + holiday ,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "supermarket",])
lm_1_convenience_withdiscount <- lm(dlogtotalvolume ~ dlogLL + dlogavgpricebefore + dlognondepth + dlogavgcompLL + dlogavgcompfinalprice + log(totalvolume1) + log(LL1) +log(avgpricebefore1) + log(nondepth1) + holiday,data=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i]& df_bybrand$format == "convenience",])

#test coefficient between price before discount (Testing linear hypothesis on the coefficients of a system of equations by an F-test or Wald-test)
  #see more https://kzee.github.io/CoeffDiff_Demo.html
coeftest_hyper<-linearHypothesis(lm_1_hyper_withdiscount, "dlogavgpricebefore - dlognondepth = 0")
coeftest_super<-linearHypothesis(lm_1_super_withdiscount, "dlogavgpricebefore - dlognondepth = 0")
coeftest_convenience<-linearHypothesis(lm_1_convenience_withdiscount, "dlogavgpricebefore - dlognondepth = 0")

#test_discount_hyper<-lrtest(lm_1_hyper, lm_1_hyper_withdiscount)
#test_discount_super<-lrtest(lm_1_super, lm_1_super_withdiscount)
#test_discount_convenience<-lrtest(lm_1_convenience, lm_1_convenience_withdiscount)
#Export Discount coefficient across format

df_linear_withdiscount_hyper[i,1] <- toString(distinctbrandcomplete[i])
df_linear_withdiscount_hyper[i,2] <- "hypermarket"
df_linear_withdiscount_hyper[i,3] = summary(lm_1_hyper)$coefficients[3,1]
df_linear_withdiscount_hyper[i,4] = summary(lm_1_hyper)$coefficients[3,2]
df_linear_withdiscount_hyper[i,5] = summary(lm_1_hyper_withdiscount)$coefficients[3,1]
df_linear_withdiscount_hyper[i,6] = summary(lm_1_hyper_withdiscount)$coefficients[3,2]
df_linear_withdiscount_hyper[i,7] = summary(lm_1_hyper_withdiscount)$coefficients[4,1]
df_linear_withdiscount_hyper[i,8] = summary(lm_1_hyper_withdiscount)$coefficients[4,2]
df_linear_withdiscount_hyper[i,9] = round(coeftest_hyper$`Pr(>F)`[2],4)
#df_linear_withdiscount_hyper[i,10] = round(test_discount_hyper$`Pr(>Chisq)`[2],4)

df_linear_withdiscount_super[i,1] <- toString(distinctbrandcomplete[i])
df_linear_withdiscount_super[i,2] <- "supermarket"
df_linear_withdiscount_super[i,3] = summary(lm_1_super)$coefficients[3,1]
df_linear_withdiscount_super[i,4] = summary(lm_1_super)$coefficients[3,2]
df_linear_withdiscount_super[i,5] = summary(lm_1_super_withdiscount)$coefficients[3,1]
df_linear_withdiscount_super[i,6] = summary(lm_1_super_withdiscount)$coefficients[3,2]
df_linear_withdiscount_super[i,7] = summary(lm_1_super_withdiscount)$coefficients[4,1]
df_linear_withdiscount_super[i,8] = summary(lm_1_super_withdiscount)$coefficients[4,2]
df_linear_withdiscount_super[i,9] = round(coeftest_super$`Pr(>F)`[2],4)
#df_linear_withdiscount_super[i,10] = round(test_discount_super$`Pr(>Chisq)`[2],4)

df_linear_withdiscount_convenience[i,1] <- toString(distinctbrandcomplete[i])
df_linear_withdiscount_convenience[i,2] <- "convenience"
df_linear_withdiscount_convenience[i,3] = summary(lm_1_convenience)$coefficients[3,1]
df_linear_withdiscount_convenience[i,4] = summary(lm_1_convenience)$coefficients[3,2]
df_linear_withdiscount_convenience[i,5] = summary(lm_1_convenience_withdiscount)$coefficients[3,1]
df_linear_withdiscount_convenience[i,6] = summary(lm_1_convenience_withdiscount)$coefficients[3,2]
df_linear_withdiscount_convenience[i,7] = summary(lm_1_convenience_withdiscount)$coefficients[4,1]
df_linear_withdiscount_convenience[i,8] = summary(lm_1_convenience_withdiscount)$coefficients[4,2]
df_linear_withdiscount_convenience[i,9] = round(coeftest_convenience$`Pr(>F)`[2],4)
#df_linear_withdiscount_convenience[i,10] = round(test_discount_convenience$`Pr(>Chisq)`[2],4)
  }

df_linear_withdiscount <- rbind(df_linear_withdiscount_hyper,df_linear_withdiscount_super,df_linear_withdiscount_convenience)

colnames(df_linear_withdiscount) <- c('brand','format','FinalPrice','(Std)','PriceBefore','(Std)','NonDiscount','(Std)','p coef test')
df_linear_withdiscount<-df_linear_withdiscount[order(df_linear_withdiscount$brand),]
xtable(df_linear_withdiscount)

remove(list=c("df_linear_withdiscount_hyper","df_linear_withdiscount_super","df_linear_withdiscount_convenience"))
```