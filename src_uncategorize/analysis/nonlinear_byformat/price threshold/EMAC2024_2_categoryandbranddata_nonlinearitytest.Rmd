---
title: "Managebrandandcategorydata"
author: "Ned"
date: "22/12/2021"
output: pdf_document
---

```{r setup and require library, include=FALSE, WARNING = FALSE}
library(plyr) #for revalue function for brand
library(dplyr) #for mutate factor level of brand
library(data.table) #for set DT checking brand
library(car) #function for testing coefficient equivalence
library(lmtest) #function for testing nonlinearity
require(nnet) #for multinomial regression
```

```{r read data, include=FALSE}
df <- read.csv("../../../../data/df_scanner_butikid_complete_filteredcat.csv")
df_holiday <- read.csv("../../../../data/weeklyholiday.csv")
```


#Function of creating relevant variables

```{r create trend variable, include=FALSE}
#very bad way of doing
df_holiday<-df_holiday [order(df_holiday$vecka),]
df_holiday$trend <- seq(1:length(unique(df_holiday$vecka)))
```

We create a function ``genrelevantvar`` that generates 1) calculate aggregate brand price/discount/unit sales of each brand from sales-weighted average across its SKUs sold in period t 2) calculated (aggregated) competitive variables and 3) generate lag variable 4) first difference of log of relevant variables (dropped the t = 1) 5) generate holiday (0/1)
  

```{r calculate the brand price related variables and linelength or our main IV, echo=FALSE}

genrelevantvar <- function(df,format,category){
  df <- df[df$category == category & df$format == format,]
  
#create own price
#Price of brand b in period t, computed as a sales-weighted average across its SKUs sold in period t
df$pricebeforeperunit <- df$spendingbeforedisc/df$sales_volume
df$finalpriceperunit <- df$finalspending/df$sales_volume
df$discountperunit <- df$totaldiscount/df$sales_volume
df$nonpricecampaign <- ifelse(df$totaldiscount == 0 & df$week_campaign > 0, 1, 0)
df$pricecampaign <- ifelse(df$totaldiscount != 0 & df$week_campaign > 0, 1, 0)
#calculated weight
weeklysalesbybrand<-setDT(df)[, .(totalsales=sum(sales_volume),LL=uniqueN(produkt_id),totalnonpricecampaign=sum(nonpricecampaign),totalpricecampaign=sum(pricecampaign)), .(vecka,brand,format)] #this will return n brand x 3 formats x 153 weeks
df_weightcalc <- merge(df,weeklysalesbybrand, by=c("vecka","brand","format"))
df_weightcalc$wp <- df_weightcalc$sales_volume/df_weightcalc$totalsales
    # check<-setDT(df_weightcalc)[, .(totalwp=sum(wp)), .(vecka,brand,format)] #check if weight sum to 1
df_weightcalc$avgpricebefore <- df_weightcalc$pricebeforeperunit*df_weightcalc$wp
df_weightcalc$avgfinalprice <- df_weightcalc$finalpriceperunit*df_weightcalc$wp
df_weightcalc$avgdiscount <- df_weightcalc$discountperunit*df_weightcalc$wp
df_bybrand <- setDT(df_weightcalc)[, .(totalvolume=sum(sales_volume),totalvalue=sum(finalspending),LL=mean(LL),avgpricebefore=sum(avgpricebefore),avgfinalprice=sum(avgfinalprice),avgdiscount=sum(avgdiscount),totalnonpricecampaign=sum(totalnonpricecampaign),totalpricecampaign=sum(totalpricecampaign)), .(vecka,brand,format)]
df_bybrand$nonpricecampaign <- ifelse(df_bybrand$totalnonpricecampaign > 0, 1, 0)
df_bybrand$pricecampaign <- ifelse(df_bybrand$totalpricecampaign > 0, 1, 0)

#create own depth
df_bybrand$depth <- df_bybrand$avgdiscount/df_bybrand$avgpricebefore
df_bybrand$nondepth <- (1-df_bybrand$depth)

#create competitive info
distinctbrandcomplete <- unique(df$brand)
nbrand<-length(distinctbrandcomplete)
nweek<-length(unique(df$vecka))

df_rep <- data.frame(matrix(NA, ncol = 19 , nrow = ((nbrand)*(nweek)))) #create an empty table for iteration information of each brand

#We calculate competitors info for each brand and then replace in the df_rep (rbind each brand)
for (i in 1:length(distinctbrandcomplete)){
df_competitor=df_bybrand[df_bybrand$brand != distinctbrandcomplete[i],]
weeklysalesbycompetingbrand<-setDT(df_competitor)[, .(totalmarketvalue=sum(totalvalue)), .(vecka)]
df_competitorweightcalc <- merge(df_competitor,weeklysalesbycompetingbrand, by=c("vecka"))
df_competitorweightcalc$wp <- df_competitorweightcalc$totalvalue/df_competitorweightcalc$totalmarketvalue
  # check<-setDT(df_competitorweightcalc)[, .(totalwp=sum(wp)), .(vecka)] #check if weight sum to 1
df_competitorweightcalc$avgcompLL <- df_competitorweightcalc$LL*df_competitorweightcalc$wp
df_competitorweightcalc$avgcomppricebefore <- df_competitorweightcalc$avgpricebefore*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompfinalprice <- df_competitorweightcalc$avgfinalprice*df_competitorweightcalc$wp
df_competitorweightcalc$avgcompdiscount <- df_competitorweightcalc$avgdiscount*df_competitorweightcalc$wp
df_competitorinfo <- setDT(df_competitorweightcalc)[, .(avgcompLL=sum(avgcompLL),avgcomppricebefore=sum(avgcomppricebefore), avgcompfinalprice=sum(avgcompfinalprice), avgcompdiscount=sum(avgcompdiscount)), .(vecka)]
df_own=df_bybrand[df_bybrand$brand == distinctbrandcomplete[i],]
df_own <- merge(df_own,df_competitorinfo, by=c("vecka"))
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),] = df_own
df_rep[(1+((i-1)*153)):(153+((i-1)*153)),2] <- toString(distinctbrandcomplete[i])
}
colnames(df_rep) <- colnames(df_own) #replace empty table column name with the original column name
df_rep[,1] <- df_own[,1] #the vecka infor is not replaced so we have to replace from the original table
df_rep$brand<-as.factor(df_rep$brand)
df_bybrand <- df_rep

#generate lag variables
lag_1 <- function(x, k = 1) head(c(rep(NA, k), x), length(x))
df_bybrand<-df_bybrand [order(df_bybrand$brand,df_bybrand$vecka),]
df_bybrand$totalvolume1 <- ave(df_bybrand$totalvolume, df_bybrand$brand, FUN= lag_1)
df_bybrand$totalvalue1 <- ave(df_bybrand$totalvalue, df_bybrand$brand, FUN= lag_1)
df_bybrand$LL1 <- ave(df_bybrand$LL, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgfinalprice1 <- ave(df_bybrand$avgfinalprice, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgpricebefore1 <- ave(df_bybrand$avgpricebefore, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgdiscount1 <- ave(df_bybrand$avgdiscount, df_bybrand$brand, FUN= lag_1)
df_bybrand$nondepth1 <- ave(df_bybrand$nondepth, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgcompLL1 <- ave(df_bybrand$avgcompLL, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgcompfinalprice1 <- ave(df_bybrand$avgfinalprice, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgcomppricebefore1 <- ave(df_bybrand$avgpricebefore, df_bybrand$brand, FUN= lag_1)
df_bybrand$avgcompdiscount1 <- ave(df_bybrand$avgdiscount, df_bybrand$brand, FUN= lag_1)

#create the first difference of log variables
df_bybrand <- na.omit(df_bybrand) #We drop week 0
df_bybrand$dlogtotalvolume <- log(df_bybrand$totalvolume)-log(df_bybrand$totalvolume1)
df_bybrand$dlogavgfinalprice <- log(df_bybrand$avgfinalprice)-log(df_bybrand$avgfinalprice1)
df_bybrand$dlogavgpricebefore <- log(df_bybrand$avgpricebefore)-log(df_bybrand$avgpricebefore1)
df_bybrand$dlognondepth <- df_bybrand$nondepth-df_bybrand$nondepth1
df_bybrand$dlogLL = log(df_bybrand$LL) - log(df_bybrand$LL1)
df_bybrand$dlogavgcompLL = log(df_bybrand$avgcompLL) - log(df_bybrand$avgcompLL1)
df_bybrand$dlogavgcompfinalprice = log(df_bybrand$avgcompfinalprice) - log(df_bybrand$avgcompfinalprice1)

#create copula
make_copula <- function(x) {
		if (length(unique(x))==1) return(as.numeric(rep(NA, length(x))))
		return(ifelse(ecdf(x)(x)==1, qnorm(1-.0000001), qnorm(ecdf(x)(x))))}
#This functions transforms a variable (condition: non-normally distributed) to its copula-correction term which can be entered in model estimation. See Park and Gupta (2012, Marketing Science)
df_bybrand$cop_logavgpricebefore <- make_copula(log((df_bybrand$avgpricebefore)))
df_bybrand$cop_logdiscount <- make_copula(log((df_bybrand$avgdiscount)))
df_bybrand$cop_avgpricebefore <- make_copula((df_bybrand$avgpricebefore))
df_bybrand$cop_discount <- make_copula(df_bybrand$avgdiscount)
df_bybrand$cop_lognondepth<- make_copula(log(df_bybrand$nondepth))
df_bybrand$cop_logavgfinalprice<- make_copula(log(df_bybrand$avgfinalprice))

#create a holiday variable
df_holiday$vecka <- as.factor(df_holiday$vecka)
df_bybrand <- merge(df_bybrand,df_holiday[,2:4], by=c("vecka"))

#convert format back
df_bybrand$format <- format
df_bybrand$category <- category

return(df_bybrand)
}
```


#Function testing discount or non-discount

```{r function for testing discount or nondiscount, echo=FALSE}

test_discount_coef <- function(aggregate_df){
  
  distinctbrandcomplete <- unique(aggregate_df$brand)
  nbrand<-length(distinctbrandcomplete)
  
  df_discount_coef_test <- data.frame(matrix(NA, ncol = 9 , nrow = (nbrand))) 
  for (i in 1:length(distinctbrandcomplete)){
lm_discount <- lm(dlogtotalvolume ~ dlogavgpricebefore + dlognondepth + dlogavgcompfinalprice + log(totalvolume1) + log(avgpricebefore1) + log(nondepth1) + cop_logavgpricebefore + cop_lognondepth  + holiday ,data=aggregate_df[aggregate_df$brand == distinctbrandcomplete[i],])

#test coefficient between price before discount (Testing linear hypothesis on the coefficients of a system of equations by an F-test or Wald-test)
  #see more https://kzee.github.io/CoeffDiff_Demo.html
coeftest<-linearHypothesis(lm_discount, "dlogavgpricebefore - dlognondepth = 0")

#Export Discount coefficient across format

df_discount_coef_test[i,1] <- paste0(unique(aggregate_df$format))
df_discount_coef_test[i,2] <- paste0(unique(aggregate_df$category))
df_discount_coef_test[i,3] <- toString(distinctbrandcomplete[i])
df_discount_coef_test[i,4] = summary(lm_discount)$coefficients[2,1]
df_discount_coef_test[i,5] = summary(lm_discount)$coefficients[2,2]
df_discount_coef_test[i,6] = summary(lm_discount)$coefficients[3,1]
df_discount_coef_test[i,7] = summary(lm_discount)$coefficients[3,2]
df_discount_coef_test[i,8] = round(coeftest$`Pr(>F)`[2],4)
df_discount_coef_test[i,9] = round(summary(lm_discount)$r.squared,4)

colnames(df_discount_coef_test) <- c('format','category','brand','Coef PriceBefore','Sd PriceBefore','Coef NonDiscount','Sd NonDiscount','p coef test','R2 of model')
  }
df_discount_coef_test$pricedecision <- ifelse(df_discount_coef_test$`p coef test`< 0.05, 'discount', 'finalprice')

return(df_discount_coef_test)
  
}
```

#Function of testing nonlinearity

```{r}
test_nonlinearity_both <- function(aggregate_df,discount_coef_result, critical_p){
  
  df_merge_result <- merge(aggregate_df,discount_coef_result, by=c("brand"))
  
  df_finalprice <- df_merge_result[df_merge_result$pricedecision == 'finalprice', ]
  df_finalprice <- df_finalprice %>% mutate(brand=droplevels(brand))
  distinctbrand_finalprice <- unique(df_finalprice$brand)
  nbrand_finalprice<-length(distinctbrand_finalprice)
  
  df_discount <- df_merge_result[df_merge_result$pricedecision == 'discount', ]
  df_discount <- df_discount %>% mutate(brand=droplevels(brand))
  distinctbrand_discount <- unique(df_discount$brand)
  nbrand_discount<-length(distinctbrand_discount)

   
 df_finalprice_lr <- data.frame(matrix(NA, ncol = 4 , nrow = (nbrand_finalprice)))  
  for (i in 1:length(distinctbrand_finalprice)){  
  
lm_finalprice <- lm(dlogtotalvolume ~ dlogavgfinalprice + dlogavgcompfinalprice + log(totalvolume1) + log(avgfinalprice1) + cop_logavgfinalprice + holiday,data=df_finalprice[df_finalprice$brand == distinctbrand_finalprice[i],])

lm_finalprice_price2 <- lm(dlogtotalvolume ~ dlogavgfinalprice + dlogavgcompfinalprice + log(totalvolume1) + log(avgfinalprice1) + cop_logavgfinalprice + holiday + I(dlogavgfinalprice^2) ,data=df_finalprice[df_finalprice$brand == distinctbrand_finalprice[i],])

test_price<-lrtest(lm_finalprice, lm_finalprice_price2)

df_finalprice_lr[i,1] <- toString(distinctbrand_finalprice[i])
df_finalprice_lr[i,2] = round(test_price$`Pr(>Chisq)`[2],3)
df_finalprice_lr[i,3] = "NA"
df_finalprice_lr[i,4] = "NA"
}  
  
 df_discount_lr <- data.frame(matrix(NA, ncol = 4 , nrow = (nbrand_discount)))  
  for (i in 1:length(distinctbrand_discount)){

lm_discount <- lm(dlogtotalvolume ~ dlogavgpricebefore + dlognondepth + dlogavgcompfinalprice + log(totalvolume1) + log(avgpricebefore1) + log(nondepth1) + cop_logavgpricebefore + cop_lognondepth  + holiday ,data=df_discount[df_discount$brand == distinctbrand_discount[i],])

lm_discount_price2 <- lm(dlogtotalvolume ~ dlogavgpricebefore + dlognondepth + dlogavgcompfinalprice + log(totalvolume1) + log(avgpricebefore1) + log(nondepth1) + cop_logavgpricebefore + cop_lognondepth  + holiday + I(dlogavgpricebefore^2) ,data=df_discount[df_discount$brand == distinctbrand_discount[i],])

lm_discount_discount2 <- lm(dlogtotalvolume ~ dlogavgpricebefore + dlognondepth + dlogavgcompfinalprice + log(totalvolume1) + log(avgpricebefore1) + log(nondepth1) + cop_logavgpricebefore + cop_lognondepth  + holiday + I(dlognondepth^2) ,data=df_discount[df_discount$brand == distinctbrand_discount[i],])

lm_discount_pricediscount2 <- lm(dlogtotalvolume ~ dlogavgpricebefore + dlognondepth + dlogavgcompfinalprice + log(totalvolume1) + log(avgpricebefore1) + log(nondepth1) + cop_logavgpricebefore + cop_lognondepth  + holiday + I(dlogavgpricebefore^2) +I(dlognondepth^2) ,data=df_discount[df_discount$brand == distinctbrand_discount[i],])

test_price<-lrtest(lm_discount, lm_discount_price2)
test_discount<-lrtest(lm_discount, lm_discount_discount2)
test_price_discount <- lrtest(lm_discount,lm_discount_pricediscount2)

df_discount_lr[i,1] <- toString(distinctbrand_discount[i])
df_discount_lr[i,2] = round(test_price$`Pr(>Chisq)`[2],3)
df_discount_lr[i,3] = round(test_discount$`Pr(>Chisq)`[2],3)
df_discount_lr[i,4] = round(test_price_discount$`Pr(>Chisq)`[2],3)
  }
 
df_nonlinearity_test <- rbind(df_discount_lr,df_finalprice_lr)
colnames(df_nonlinearity_test) <- c('brand','p-value-price^2','p-value-discount^2','p-value-priceanddiscount^2')

#give the decision in this nonlinearitystep
critical_p = critical_p

df_nonlinearity_test$linearitydecision <- "nonlinearity"
df_nonlinearity_test$linearitydecision[df_nonlinearity_test$`p-value-price^2` >= critical_p & df_nonlinearity_test$`p-value-discount^2` =="NA"] <- "linearity"
df_nonlinearity_test$linearitydecision[df_nonlinearity_test$`p-value-price^2` >= critical_p & df_nonlinearity_test$`p-value-discount^2` >= critical_p & df_nonlinearity_test$`p-value-priceanddiscount^2`>=critical_p] <- "linearity"

df_nonlinearity_test$nonlinearitydecision <- "nonlinearity"
df_nonlinearity_test$nonlinearitydecision[df_nonlinearity_test$`linearitydecision` =="linearity"] <- "linearity"
df_nonlinearity_test$nonlinearitydecision[df_nonlinearity_test$`p-value-price^2` < critical_p & df_nonlinearity_test$`p-value-discount^2` >= critical_p] <- "pricebeforenonlinearity"
df_nonlinearity_test$nonlinearitydecision[df_nonlinearity_test$`p-value-price^2` < critical_p & df_nonlinearity_test$`p-value-discount^2` == "NA"] <- "finalpricenonlinearity"
df_nonlinearity_test$nonlinearitydecision[df_nonlinearity_test$`p-value-price^2` >= critical_p & df_nonlinearity_test$`p-value-discount^2` < critical_p] <- "discountnonlinearity"
df_nonlinearity_test$nonlinearitydecision[df_nonlinearity_test$`p-value-price^2` < critical_p & df_nonlinearity_test$`p-value-discount^2` < critical_p & df_nonlinearity_test$`p-value-priceanddiscount^2`< critical_p] <- "priceanddiscountnonlinearity"

df_nonlinearity_test$format <- paste0(unique(aggregate_df$format))
df_nonlinearity_test$category <- paste0(unique(aggregate_df$category))

return(df_nonlinearity_test)
  
}

```


This function returns p-value for likelihood ratio test when non-linearity term (or quadratic term) is added and conclusion whether which fuction should be performed. 


However, we still need to create another function that skip some lm in case of all brands have significant discount parameters and vice versa (LATER).

```{r}

test_nonlinearity_onlyfinalprice <- function(aggregate_df){
  
  distinctbrand_finalprice <- unique(aggregate_df$brand)
  nbrand_finalprice<-length(distinctbrand_finalprice)
  
   
 df_finalprice_lr <- data.frame(matrix(NA, ncol = 8 , nrow = (nbrand_finalprice)))  
  for (i in 1:length(distinctbrand_finalprice)){  
  
lm_finalprice <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + dlogavgcompLL + dlogavgcompfinalprice  + nonpricecampaign + pricecampaign + log(totalvolume1) + log(LL1) +log(avgfinalprice1) + trend + holiday ,data=aggregate_df[aggregate_df$brand == distinctbrand_finalprice[i],])


lm_finalprice_priceprice <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + I(dlogavgfinalprice^2)+ I(dlogavgfinalprice^3) + dlogavgcompLL + dlogavgcompfinalprice  + nonpricecampaign + pricecampaign + log(totalvolume1) + log(LL1) +log(avgfinalprice1)+ trend + holiday ,data=aggregate_df[aggregate_df$brand == distinctbrand_finalprice[i],])

lm_finalprice_compgap <- lm(dlogtotalvolume ~ dlogLL + dlogavgfinalprice + dlogavgfinalprice*dlogavgcompfinalprice + dlogavgfinalprice*I(dlogavgcompfinalprice^2) + dlogavgcompLL + dlogavgcompfinalprice  + nonpricecampaign + pricecampaign + log(totalvolume1) + log(LL1) +log(avgfinalprice1)+ trend + holiday ,data=aggregate_df[aggregate_df$brand == distinctbrand_finalprice[i],])

test_price1 <-lrtest(lm_finalprice, lm_finalprice_priceprice)
test_price2 <-lrtest(lm_finalprice, lm_finalprice_compgap)

df_finalprice_lr[i,1] <- toString(distinctbrand_finalprice[i])
df_finalprice_lr[i,2] = round(test_price1$`Pr(>Chisq)`[2],4)
df_finalprice_lr[i,3] = round(test_price2$`Pr(>Chisq)`[2],4)
df_finalprice_lr[i,4] = summary(lm_finalprice)$coefficients[3,1]
df_finalprice_lr[i,5] = summary(lm_finalprice)$coefficients[3,2]
#df_finalprice_lr[i,6] = round(summary(lm_finalprice)$coefficients[10,1]/summary(lm_finalprice)$coefficients[8,1],4)
df_finalprice_lr[i,6] = round(summary(lm_finalprice)$r.squared,4)
#df_finalprice_lr[i,8] = summary(lm_finalprice)$coefficients[4,1]
#df_finalprice_lr[i,9] = summary(lm_finalprice)$coefficients[4,2]
df_finalprice_lr[i,7] = round(summary(lm_finalprice_priceprice)$r.squared,4)
df_finalprice_lr[i,8] = round(summary(lm_finalprice_compgap)$r.squared,4)
}  
  
colnames(df_finalprice_lr) <- c('brand','p-value-LRhist','p-value-LRcomp','Coef Price','Sd Price','RsqLinear','RsqHist','RsqComp')

 #colnames(df_finalprice_lr) <- c('brand','p-value-pricehist','p-value-pricecom','Coef Price','Sd Price','Coef Long','RsqLinearmod','coefprice2','sdprice2')


return(df_finalprice_lr)
  
}
```


#Empirical Test for nonlinearity
```{r Butter}
#Create aggregate dataframe
df_butter_hyper <- genrelevantvar(df,format = "hypermarket",category ="Butter")
df_butter_super <- genrelevantvar(df,format = "supermarket",category ="Butter")

#test discount coefficient
discount_test_butter_hyper <- test_discount_coef(aggregate_df = df_butter_hyper)
discount_test_butter_super <- test_discount_coef(aggregate_df = df_butter_super)

#test nonlinearity
nonlinear_test_butter_hyper <- test_nonlinearity_both(aggregate_df = df_butter_hyper,discount_coef_result = discount_test_butter_hyper, critical_p = 0.10)
nonlinear_test_butter_super <- test_nonlinearity_both(aggregate_df = df_butter_super,discount_coef_result = discount_test_butter_super, critical_p = 0.10)
```

```{r Bread}
#Create aggregate dataframe
df_bread_hyper <- genrelevantvar(df,format = "hypermarket",category ="Bread")
df_bread_super <- genrelevantvar(df,format = "supermarket",category ="Bread")

#test discount coefficient
discount_test_bread_hyper <- test_discount_coef(aggregate_df = df_bread_hyper)
discount_test_bread_super <- test_discount_coef(aggregate_df = df_bread_super) #CANNOT RUN BECAUSE some brand never change their price
```

```{r Butter}
#Create aggregate dataframe
df_cream_hyper <- genrelevantvar(df,format = "hypermarket",category ="Cream")
df_cream_super <- genrelevantvar(df,format = "supermarket",category ="Cream")

#test discount coefficient
discount_test_cream_hyper <- test_discount_coef(aggregate_df = df_cream_hyper) #CANNOT RUN BECAUSE some brand never change their price
discount_test_cream_super <- test_discount_coef(aggregate_df = df_cream_super)
```

```{r Milk}
#Create aggregate dataframe
df_butter_hyper <- genrelevantvar(df,format = "hypermarket",category ="Milk")
df_butter_super <- genrelevantvar(df,format = "supermarket",category ="Milk") #only Arla Ko is sold LOL
```

```{r Butter}
#Create aggregate dataframe
df_toilettissue_hyper <- genrelevantvar(df,format = "hypermarket",category ="Toilet tissue")
df_toilettissue_super <- genrelevantvar(df,format = "supermarket",category ="Toilet tissue")

#test discount coefficient
discount_test_toilettissue_hyper <- test_discount_coef(aggregate_df = df_toilettissue_hyper)
discount_test_toilettissue_super <- test_discount_coef(aggregate_df = df_toilettissue_super)
```